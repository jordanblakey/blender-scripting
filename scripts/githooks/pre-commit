#!/usr/bin/env sh
# pre commit hook for linting, formatting, and running tests

set -e

printf "\033[33mpre-commit hook \033[0m\n"

# ensure the pre-commit uses the correct python environment
poetry env use python3
eval $(poetry env activate | sed 's/source/./')

printf "\033[35mruff format . \033[0m\n"
# format: auto fix as much as possible
ruff format .

printf "\033[35mruff check . \033[0m\n"
# lint: what couldn't be fixed
ruff check .

# lint and format shell scripts
./scripts/shfmt_and_shellcheck.sh

printf "\033[35mrunning tests \033[0m\n"
gh act push

printf "\033[32mpre-commit hook complete \033[0m\n"
